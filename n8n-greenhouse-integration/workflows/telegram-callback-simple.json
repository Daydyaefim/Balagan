{
  "name": "Telegram Callback Simple",
  "nodes": [
    {
      "parameters": {
        "updates": ["callback_query"]
      },
      "id": "telegram-trigger",
      "name": "Telegram Callback",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [240, 300],
      "webhookId": "telegram-callback-webhook",
      "credentials": {
        "telegramApi": {
          "id": "telegram_bot",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst callbackData = data.callback_query.callback_data;\nconst callbackQueryId = data.callback_query.id;\n\n// –ü–∞—Ä—Å–∏–º callback_data: \"ack_low_temperature\" –∏–ª–∏ \"mute_low_temperature_1h\"\nconst parts = callbackData.split('_');\nconst action = parts[0]; // \"ack\" –∏–ª–∏ \"mute\"\nconst alertType = parts.slice(1, -1).join('_'); // \"low_temperature\"\nconst duration = parts[parts.length - 1]; // \"1h\" –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—è—è —á–∞—Å—Ç—å alertType\n\n// –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ workflow static data\nconst staticData = $getWorkflowStaticData('global');\nif (!staticData.alertStates) {\n  staticData.alertStates = {};\n}\n\nif (!staticData.alertStates[alertType]) {\n  staticData.alertStates[alertType] = { acknowledged: false, mutedUntil: null };\n}\n\nconst state = staticData.alertStates[alertType];\nlet responseText = '';\n\nif (action === 'ack') {\n  // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ø–∞–º\n  state.acknowledged = true;\n  responseText = '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ. –°–ø–∞–º –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.';\n} else if (action === 'mute') {\n  // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º—è\n  const now = new Date();\n  const muteUntil = new Date(now.getTime() + 60 * 60 * 1000); // +1 —á–∞—Å\n  state.mutedUntil = muteUntil.toISOString();\n  state.acknowledged = true;\n  responseText = 'üîï –û—Ç–∫–ª—é—á–µ–Ω–æ –Ω–∞ 1 —á–∞—Å.';\n}\n\n// –°–æ—Ö—Ä–∞–Ω—è–µ–º\nstaticData.alertStates[alertType] = state;\n\nreturn [{\n  json: {\n    callback_query_id: callbackQueryId,\n    text: responseText,\n    show_alert: false\n  }\n}];"
      },
      "id": "process-callback",
      "name": "Process Callback",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.telegram.org/bot{{ $credentials.telegramApi.accessToken }}/answerCallbackQuery",
        "authentication": "genericCredentialType",
        "genericAuthType": "telegramApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "id": "answer-callback",
      "name": "Answer Callback",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [680, 300],
      "credentials": {
        "telegramApi": {
          "id": "telegram_bot",
          "name": "Telegram Bot API"
        }
      }
    }
  ],
  "connections": {
    "Telegram Callback": {
      "main": [[{ "node": "Process Callback", "type": "main", "index": 0 }]]
    },
    "Process Callback": {
      "main": [[{ "node": "Answer Callback", "type": "main", "index": 0 }]]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-01-20T00:00:00.000Z",
  "versionId": "1"
}
