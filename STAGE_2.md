# –ü–õ–ê–ù –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê UgAgro_95 - STAGE 2

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª:** UgAgro_95/UgAgro_95.ino (4164 —Å—Ç—Ä–æ–∫–∏)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–º–Ω–æ–π —Ç–µ–ø–ª–∏—Ü–µ–π –Ω–∞ ESP32
- **–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** 2025-11-17

## –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞
1. ‚ö†Ô∏è **–ú–æ–Ω–æ–ª–∏—Ç–Ω–æ—Å—Ç—å** - –≤–µ—Å—å –∫–æ–¥ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ (4164 —Å—Ç—Ä–æ–∫–∏)
2. ‚ö†Ô∏è **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** - 154+ –±–ª–æ–∫–æ–≤ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–≥–æ –∫–æ–¥–∞ –¥–ª—è MQTT/Web
3. ‚ö†Ô∏è **–û–≥—Ä–æ–º–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Settings** - 100+ –ø–æ–ª–µ–π –±–µ–∑ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
4. ‚ö†Ô∏è **–ì–∏–≥–∞–Ω—Ç—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è logicTask** - ~900 —Å—Ç—Ä–æ–∫ —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –ª–æ–≥–∏–∫–∏
5. ‚ö†Ô∏è **Callback —Ñ—É–Ω–∫—Ü–∏—è** - 800+ —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ MQTT –∫–æ–º–∞–Ω–¥
6. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –∏ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏
7. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–æ–≤

---

## –≠–¢–ê–ü 1: –ú–æ–¥—É–ª—å–Ω–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è ‚úÖ –í–´–ü–û–õ–ù–ï–ù
### –¶–µ–ª—å: –†–∞–∑–¥–µ–ª–∏—Ç—å –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –∫–æ–¥ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏

### –ó–∞–¥–∞—á–∏:
- [x] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- [x] –í—ã–¥–µ–ª–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã (config.h)
- [x] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª–∏ –¥–ª—è –¥–∞—Ç—á–∏–∫–æ–≤ (sensors/)
- [x] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ (controllers/)
- [x] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ (communication/)
- [x] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (storage/)
- [x] –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã (utils/)

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
UgAgro_95_refactored/
‚îú‚îÄ‚îÄ UgAgro_95_refactored.ino
‚îú‚îÄ‚îÄ config.h
‚îú‚îÄ‚îÄ sensors/
‚îÇ   ‚îú‚îÄ‚îÄ ModbusManager.h/cpp
‚îÇ   ‚îú‚îÄ‚îÄ SensorReader.h/cpp
‚îÇ   ‚îî‚îÄ‚îÄ SensorData.h
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ WindowController.h/cpp
‚îÇ   ‚îú‚îÄ‚îÄ HeatingController.h/cpp
‚îÇ   ‚îú‚îÄ‚îÄ FogController.h/cpp
‚îÇ   ‚îú‚îÄ‚îÄ WateringController.h/cpp
‚îÇ   ‚îî‚îÄ‚îÄ RelayController.h/cpp
‚îú‚îÄ‚îÄ communication/
‚îÇ   ‚îú‚îÄ‚îÄ MQTTHandler.h/cpp
‚îÇ   ‚îú‚îÄ‚îÄ WebServer.h/cpp
‚îÇ   ‚îî‚îÄ‚îÄ NetworkManager.h/cpp
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îú‚îÄ‚îÄ SettingsManager.h/cpp
‚îÇ   ‚îî‚îÄ‚îÄ HistoryManager.h/cpp
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ TimeManager.h/cpp
    ‚îî‚îÄ‚îÄ Helpers.h/cpp
```

---

## –≠–¢–ê–ü 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Settings ‚úÖ –í–´–ü–û–õ–ù–ï–ù
### –¶–µ–ª—å: –†–∞–∑–¥–µ–ª–∏—Ç—å –º–æ–Ω–æ–ª–∏—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É Settings –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø—ã

### –ó–∞–¥–∞—á–∏:
- [x] –°–æ–∑–¥–∞—Ç—å WindowSettings (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞–º–∏)
- [x] –°–æ–∑–¥–∞—Ç—å HeatingSettings (–æ—Ç–æ–ø–ª–µ–Ω–∏–µ)
- [x] –°–æ–∑–¥–∞—Ç—å FogSettings (—Å–∏—Å—Ç–µ–º–∞ —Ç—É–º–∞–Ω–∞)
- [x] –°–æ–∑–¥–∞—Ç—å WateringSettings (—Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–∏–≤–∞)
- [x] –°–æ–∑–¥–∞—Ç—å FanSettings (–≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è)
- [x] –°–æ–∑–¥–∞—Ç—å LevelSettings (—É—Ä–æ–≤–µ–Ω—å –≤–æ–¥—ã)
- [x] –°–æ–∑–¥–∞—Ç—å SolutionSettings (–ø–æ–¥–æ–≥—Ä–µ–≤ —Ä–∞—Å—Ç–≤–æ—Ä–∞)
- [x] –°–æ–∑–¥–∞—Ç—å GeneralSettings (–æ–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ SettingsManager

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ Settings —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ 8 –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π —Å —á–µ—Ç–∫–∏–º–∏ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.

---

## –≠–¢–ê–ü 3: –ü–∞—Ç—Ç–µ—Ä–Ω Command –¥–ª—è MQTT/Web ‚úÖ –ó–ê–í–ï–†–®–ï–ù
### –¶–µ–ª—å: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-11-17

### –ü—Ä–æ–±–ª–µ–º–∞:
–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∞–ª–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π –∫–æ–¥ –≤:
- `callback()` —Ñ—É–Ω–∫—Ü–∏–∏ (MQTT) - —Å—Ç—Ä–æ–∫–∏ 965-1787 (800+ —Å—Ç—Ä–æ–∫)
- Web handlers - —Å—Ç—Ä–æ–∫–∏ 3126-4089
- `loadSettings()` / `saveSettings()` / `publishSettings()`

–ü—Ä–∏–º–µ—Ä –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:
```cpp
// –í callback (MQTT)
if (doc.containsKey("minTemp")) {
  float val = doc["minTemp"];
  if (sett.minTemp != val) {
    sett.minTemp = val;
    needSave = true;
  }
}

// –í web handler (HTTP) - –ò–î–ï–ù–¢–ò–ß–ù–´–ô –ö–û–î!
if (doc.containsKey("minTemp")) {
  float val = doc["minTemp"];
  if (sett.minTemp != val) {
    sett.minTemp = val;
    needSave = true;
  }
}
```

### –†–µ—à–µ–Ω–∏–µ:
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–∞—Ç—Ç–µ—Ä–Ω **Command** —Å –µ–¥–∏–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏:

1. **–ë–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–∞–Ω–¥—ã:**
```cpp
class ICommand {
public:
  virtual bool execute(JsonDocument& doc, bool& needSave) = 0;
  virtual const char* getName() const = 0;
  virtual bool validate(JsonDocument& doc) const = 0;
};
```

2. **–î–∏—Å–ø–µ—Ç—á–µ—Ä –∫–æ–º–∞–Ω–¥:**
```cpp
class CommandDispatcher {
private:
  std::map<String, ICommand*> commands;
public:
  void registerCommand(ICommand* cmd);
  bool dispatch(const char* name, JsonDocument& doc, bool& needSave);
  int processDocument(JsonDocument& doc, bool& needSave);
};
```

3. **–®–∞–±–ª–æ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∫–æ–º–∞–Ω–¥:**
```cpp
template<typename T>
class SettingCommand : public ICommand { ... };

class FloatRangeCommand : public SettingCommand<float> { ... };
class UInt8RangeCommand : public SettingCommand<uint8_t> { ... };
class UInt32Command : public SettingCommand<uint32_t> { ... };
class IntRangeCommand : public SettingCommand<int> { ... };
class BoolCommand : public SettingCommand<bool> { ... };
```

4. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥:**
```cpp
class AllCommands {
  void registerAllCommands(CommandDispatcher& dispatcher);
  // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç 90+ –∫–æ–º–∞–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
};
```

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å ICommand
- ‚úÖ –°–æ–∑–¥–∞–Ω CommandDispatcher
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —à–∞–±–ª–æ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∫–æ–º–∞–Ω–¥ (5 —Ç–∏–ø–æ–≤)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã/–≤–ª–∞–∂–Ω–æ—Å—Ç–∏ (4 –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–∫–æ–Ω (3 –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–æ–ø–ª–µ–Ω–∏—è (4 –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç—É–º–∞–Ω–∞ (22 –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ª–∏–≤–∞ (40+ –∫–æ–º–∞–Ω–¥)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ (4 –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞—Å—Ç–≤–æ—Ä–∞ (4 –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É—Ä–æ–≤–Ω—è (3 –∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ (6 –∫–æ–º–∞–Ω–¥)
- ‚úÖ –ü–æ–∫–∞–∑–∞–Ω –ø—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ MQTT –∏ Web
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ **~2000+ —Å—Ç—Ä–æ–∫**
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ (CommandDispatcher)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ (1 —Å—Ç—Ä–æ–∫–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
- ‚úÖ –ì–æ—Ç–æ–≤–∞—è –æ—Å–Ω–æ–≤–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –ø–æ–ª–Ω—ã–π –∫–æ–¥

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
```
UgAgro_95_refactored/
‚îú‚îÄ‚îÄ UgAgro_95_refactored.ino         # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã
‚îú‚îÄ‚îÄ Settings.h                        # –†–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îú‚îÄ‚îÄ ICommand.h                   # –ë–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îú‚îÄ‚îÄ CommandDispatcher.h          # –î–∏—Å–ø–µ—Ç—á–µ—Ä –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ SettingCommands.h            # –®–∞–±–ª–æ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ AllCommands.h                # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è 90+ –∫–æ–º–∞–Ω–¥
‚îî‚îÄ‚îÄ README.md                         # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ:
| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-------|---------|-----------|
| callback() | 800+ —Å—Ç—Ä–æ–∫ | ~10 —Å—Ç—Ä–æ–∫ | -98.75% |
| web handlers | 800+ —Å—Ç—Ä–æ–∫ | ~10 —Å—Ç—Ä–æ–∫ | -98.75% |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | 154+ –±–ª–æ–∫–æ–≤ | 0 –±–ª–æ–∫–æ–≤ | -100% |
| –í–∞–ª–∏–¥–∞—Ü–∏—è | –ß–∞—Å—Ç–∏—á–Ω–∞—è | –ü–æ–ª–Ω–∞—è | +100% |
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã | 8+ –ø—Ä–∞–≤–æ–∫ | 1 —Å—Ç—Ä–æ–∫–∞ | -87.5% |

---

## –≠–¢–ê–ü 4: State Machine –¥–ª—è –ø–æ–ª–∏–≤–∞ üìã –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù
### –¶–µ–ª—å: –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –ø–æ–ª–∏–≤–∞ —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω–µ—á–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞:
–õ–æ–≥–∏–∫–∞ –ø–æ–ª–∏–≤–∞ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–∞ –ø–æ ~500 —Å—Ç—Ä–æ–∫–∞–º –∫–æ–¥–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Ñ–ª–∞–≥–æ–≤:
- wateringMode (0=auto, 1=manual, 2=—Ä–µ–∂–∏–º—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏)
- morningWateringActive
- forceWateringActive
- forceWateringOverride
- forcedWateringPerformed
- morningStartedToday
- hydroMix
- –∏ –¥—Ä.

### –ü–æ–¥—Ö–æ–¥:
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **State Machine** —Å —è–≤–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏:

```
States:
- IDLE (–æ–∂–∏–¥–∞–Ω–∏–µ)
- MORNING_SEQUENCE (—É—Ç—Ä–µ–Ω–Ω—è—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- AUTO_WAITING (–∞–≤—Ç–æ —Ä–µ–∂–∏–º, –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ radSum)
- AUTO_CHECKING (–ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –ø–æ–ª–∏–≤–∞)
- MANUAL_INTERVAL (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏–≤)
- WATERING (–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª–∏–≤)
- HYDRO_MIX (—Å–º–µ—à–∏–≤–∞–Ω–∏–µ —Ä–∞—Å—Ç–≤–æ—Ä–∞)
- FORCED_FILL (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ)
- FORCED_WATERING (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–ª–∏–≤)

Transitions:
IDLE ‚Üí MORNING_SEQUENCE (–µ—Å–ª–∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ morning)
MORNING_SEQUENCE ‚Üí WATERING (–Ω–∞—á–∞–ª–æ –ø–æ–ª–∏–≤–∞)
WATERING ‚Üí MORNING_SEQUENCE (–µ—Å–ª–∏ –µ—Å—Ç—å –µ—â–µ —Ü–∏–∫–ª—ã)
MORNING_SEQUENCE ‚Üí AUTO_WAITING (–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ morning)
AUTO_WAITING ‚Üí AUTO_CHECKING (radSum >= threshold)
AUTO_CHECKING ‚Üí WATERING (—É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã)
WATERING ‚Üí AUTO_WAITING (–ø–æ–ª–∏–≤ –∑–∞–≤–µ—Ä—à–µ–Ω)
...
```

### –ó–∞–¥–∞—á–∏:
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (enum State)
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å WateringStateMachine
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –ø–µ—Ä–µ—Ö–æ–¥–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ WateringController
- [ ] –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–ª–∞–≥–∏
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å logicTask

---

## –≠–¢–ê–ü 5: Unit —Ç–µ—Å—Ç—ã üìã –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù
### –¶–µ–ª—å: –û–±–µ—Å–ø–µ—á–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏

### –ó–∞–¥–∞—á–∏:
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PlatformIO –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–∫–∏ –¥–ª—è –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è WateringStateMachine
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è WindowController
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è SettingsManager
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è CommandDispatcher
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å enum –¥–ª—è —Ä–µ–∂–∏–º–æ–≤ –≤–º–µ—Å—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ø–∏–Ω–æ–≤ GPIO
- [ ] –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- [ ] –î–æ–±–∞–≤–∏—Ç—å watchdog –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–≤–∏—Å–∞–Ω–∏–π
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- –û–¥–∏–Ω —Ñ–∞–π–ª: 4164 —Å—Ç—Ä–æ–∫–∏
- –§—É–Ω–∫—Ü–∏—è callback: 800+ —Å—Ç—Ä–æ–∫
- –§—É–Ω–∫—Ü–∏—è logicTask: 900+ —Å—Ç—Ä–æ–∫
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: 154+ –±–ª–æ–∫–æ–≤

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: 15+ —Ñ–∞–π–ª–æ–≤
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: < 300 —Å—Ç—Ä–æ–∫
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏: < 100 —Å—Ç—Ä–æ–∫
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏: > 70%
